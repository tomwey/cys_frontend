<!--
  Generated template for the MediaListPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header no-border>

  <ion-navbar color="white">
    <ion-title>
      <span class="custom-btn" (tap)="selectItem('latest');" 
        [class.active]="dataType === 'latest'">最新</span>
      <span class="custom-btn" (tap)="selectItem('hot');" 
        [class.active]="dataType === 'hot'">最热</span>
    </ion-title>
    <ion-buttons end>
      <button ion-button small class="school-btn">
        学校&nbsp;<ion-icon name="ios-arrow-down-outline"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content>
  <div class="empty-error-box" *ngIf="!!error">
    {{error.message || error}}
  </div>
  <div class="media-data">
    <ion-card *ngFor="let media of mediaData" (tap)="selectMedia(media)" tappable>
      <ion-item>
        <ion-avatar item-start>
          <img [src]="media.cover" />
        </ion-avatar>
        <h2>{{media.owner && media.owner.name}}</h2>
        <p>{{media.owner && media.owner.school}}</p>
      </ion-item>

      <!-- <img [src]="media.cover" /> -->
      <div class="media-player" *ngIf="!isAndroid">
        
      <vg-player (onPlayerReady)="onPlayerReady($event)">
          <div class="custom-play-button" (tap)="currentMedia && currentMedia !== myMedia && 
            currentMedia.pause(); media.playing ? myMedia.pause() : myMedia.play();currentMedia = myMedia;media.playing = !media.playing;">
            <button ion-button clear color="white" 
              class="play-button">
              <ion-icon name="ios-play-outline" *ngIf="currentMedia !== myMedia || !media.playing"></ion-icon>
            </button>
          </div>
          <!-- <vg-overlay-play>
              <button ion-button clear color="white" class="play-button">
                  <ion-icon name="ios-play-outline"></ion-icon>
                </button>
          </vg-overlay-play> -->
          <vg-buffering></vg-buffering>

          <!-- <vg-controls> -->
            <vg-scrub-bar [vgSlider]="false" style="pointer-events: none;">
                <vg-scrub-bar-current-time></vg-scrub-bar-current-time>
                <vg-scrub-bar-buffering-time></vg-scrub-bar-buffering-time>
            </vg-scrub-bar>
          <!-- </vg-controls> -->
          

          <!-- <vg-controls [vgAutohide]="true" [vgAutohideTime]="5">
            <vg-play-pause></vg-play-pause>
            <vg-time-display [vgProperty]="'current'"></vg-time-display>
            <vg-scrub-bar>
              <vg-scrub-bar-current-time [vgSlider]="true"></vg-scrub-bar-current-time>
              <vg-scrub-bar-buffering-time></vg-scrub-bar-buffering-time>
            </vg-scrub-bar>
            <vg-time-display [vgProperty]="'total'"></vg-time-display>
            <vg-fullscreen></vg-fullscreen>
          </vg-controls> -->
          <video #myMedia [vgMedia]="myMedia" 
            playsinline webkit-playsinline
            x-webkit-airplay="true" 
            x5-video-player-type="h5"
            x5-video-orientation="h5"

            id="vid-{{media.id}}"
            poster="{{media.cover}}" 
            src="{{media.media_file}}"></video>
        </vg-player>

      </div>

      <!-- <div class="android-player" *ngIf="isAndroid">
          <div class="custom-play-button" (tap)="playAndroidVideo(media.id);">
              <button ion-button clear color="white" 
                class="play-button">
                <ion-icon name="ios-play-outline"></ion-icon>
              </button>
            </div>
          <video id="video-{{media.id}}" x5-video-player-type="h5" 
            x5-video-player-fullscreen="true" 
            x-webkit-airplay="allow" 
            webkit-playsinline playsinline  
            poster="{{media.cover}}" 
            src="{{media.media_file}}"></video>
        <canvas id="canvas-{{media.id}}"></canvas>
      </div> -->

      <ion-card-content>
        <p>{{media.title}}</p>
      </ion-card-content>

      <ion-row>
        <ion-col col-4>
          <button ion-button icon-left small clear>
            <ion-icon name="ios-videocam-outline"></ion-icon>
            <span>{{media.views_count}}</span>
          </button>
        </ion-col>
        <ion-col col-4 style="text-align: center;">
          <button ion-button icon-left small clear>
            <ion-icon name="ios-heart-outline"></ion-icon>
            <span>{{media.likes_count}}</span>
          </button>
        </ion-col>
        <ion-col col-4 style="text-align: right;">
          <button ion-button icon-left small clear>
            <ion-icon name="ios-chatbubbles-outline"></ion-icon>
            <span>{{media.comments_count}}</span>
          </button>
        </ion-col>
      </ion-row>
    </ion-card>
  </div>

  <ion-infinite-scroll (ionInfinite)="loadMore($event)" [enabled]="hasMore">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      loadingText="正在加载...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>
